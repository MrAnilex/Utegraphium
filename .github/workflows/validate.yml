name: Validate Site

on:
  pull_request:
    branches: [ main, master ]
  push:
    branches: [ main, master ]

jobs:
  validate:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout
      uses: actions/checkout@v4
      
    - name: Setup Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '18'
        
    - name: Validate HTML structure
      run: |
        echo "üîç Validating HTML files..."
        
        # Check if main files exist
        if [ ! -f "index.html" ]; then
          echo "‚ùå index.html not found"
          exit 1
        fi
        
        if [ ! -f "404.html" ]; then
          echo "‚ùå 404.html not found"
          exit 1
        fi
        
        if [ ! -f "manifest.json" ]; then
          echo "‚ùå manifest.json not found"
          exit 1
        fi
        
        if [ ! -f "sw.js" ]; then
          echo "‚ùå sw.js not found"
          exit 1
        fi
        
        echo "‚úÖ All required files found"
        
    - name: Validate CSS
      run: |
        echo "üé® Validating CSS files..."
        
        if [ ! -f "styles.css" ]; then
          echo "‚ùå styles.css not found"
          exit 1
        fi
        
        if [ ! -f "assets/css/styles.css" ]; then
          echo "‚ùå assets/css/styles.css not found"
          exit 1
        fi
        
        echo "‚úÖ CSS files found"
        
    - name: Validate assets structure
      run: |
        echo "üìÅ Validating assets structure..."
        
        # Check if assets directory exists
        if [ ! -d "assets" ]; then
          echo "‚ùå assets directory not found"
          exit 1
        fi
        
        # Check if subdirectories exist
        if [ ! -d "assets/css" ]; then
          echo "‚ùå assets/css directory not found"
          exit 1
        fi
        
        if [ ! -d "assets/js" ]; then
          echo "‚ùå assets/js directory not found"
          exit 1
        fi
        
        if [ ! -d "assets/images" ]; then
          echo "‚ùå assets/images directory not found"
          exit 1
        fi
        
        echo "‚úÖ Assets structure is valid"
        
    - name: Check file sizes
      run: |
        echo "üìä Checking file sizes..."
        
        # Check if any file is too large (> 10MB)
        find . -type f -size +10M | while read file; do
          echo "‚ö†Ô∏è  Large file detected: $file"
        done
        
        echo "‚úÖ File size check completed"
        
    - name: Validate URLs in HTML
      run: |
        echo "üîó Validating internal links..."
        
        # Basic check for common issues
        if grep -r "http://localhost" . --include="*.html" --include="*.js" --include="*.css"; then
          echo "‚ö†Ô∏è  Localhost URLs found - these should be relative or HTTPS"
        fi
        
        echo "‚úÖ URL validation completed"
